#! /usr/bin/env bash

if [ -f .env ]; then
  # shellcheck disable=SC1091
  source .env
fi

# Check for bun, as it is required for the build process.
command -v bun &> /dev/null || {
  echo "bun is not installed. Please install bun to continue."
  exit 1
}

# Exit if linting fails.
bun run lint || exit 1

# Update static.mouse.rip if the UPDATE_STATIC_MOUSE_RIP command is available.
if [ -n "$UPDATE_STATIC_MOUSE_RIP" ]; then
  $UPDATE_STATIC_MOUSE_RIP > /dev/null 2>&1
fi

# Tag the version, the publish workflow will handle the actual release.
version=$(bun run get-version)
git tag -a "v$version" -m "Release v$version" --force || exit 1
git push origin main || exit 1
git push origin "v$version" --force || exit 1
